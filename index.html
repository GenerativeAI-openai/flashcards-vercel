<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<title>í”Œë˜ì‹œì¹´ë“œ</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
:root{
--bg:#ffffff;--fg:#111;--muted:#666;--border:#e6e6e6;
--primary:#111;--accent:#0a7cff;--success:#10b981;--danger:#ef4444;
--card:#fafafa;--shadow:0 6px 24px rgba(0,0,0,0.08);--radius:18px;
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:var(--bg);color:var(--fg);
font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR";}
.wrap{max-width:980px;margin:0 auto;padding:24px}
.topbar{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:16px}
.brand{font-weight:700;font-size:20px}
.settings{display:flex;align-items:center;gap:12px}
.card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:16px}
.row{display:flex;gap:12px;flex-wrap:wrap}
.row > * {flex:1 1 280px}
label{font-size:12px;color:var(--muted);display:block;margin-bottom:6px}
input,textarea{width:100%;padding:12px 14px;border:1px solid var(--border);
border-radius:12px;background:#fff;font-size:14px}
textarea{min-height:92px;resize:vertical}
.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;
padding:10px 14px;border-radius:12px;border:1px solid var(--border);
background:#fff;color:var(--fg);cursor:pointer;font-weight:600;}
.btn:hover{background:#f6f6f6}
.btn.primary{background:var(--primary);color:#fff;border-color:var(--primary)}
.btn.accent{background:var(--accent);color:#fff;border-color:var(--accent)}
.btn.success{background:var(--success);color:#fff;border-color:var(--success)}
.btn.danger{background:var(--danger);color:#fff;border-color:var(--danger)}
.hint{font-size:12px;color:var(--muted)}
.toolbar{display:flex;gap:8px;flex-wrap:wrap}
.list{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:12px;margin-top:12px}
.item{background:#fff;border:1px solid var(--border);border-radius:14px;padding:12px}
.item h4{margin:0 0 6px 0;font-size:15px}
.item p{margin:0;color:#333;font-size:14px;white-space:pre-wrap}
.stage{display:flex;justify-content:center;align-items:center;margin-top:20px}
.flip{width:360px;height:220px;perspective:1000px;}
.flip-inner{position:relative;width:100%;height:100%;transform-style:preserve-3d;
transition:transform .6s cubic-bezier(.22,.61,.36,1);}
.flip.is-flipped .flip-inner{transform:rotateY(180deg)}
.face{position:absolute;inset:0;background:#fff;border:1px solid var(--border);
border-radius:20px;box-shadow:var(--shadow);display:flex;align-items:center;
justify-content:center;padding:24px;backface-visibility:hidden;}
.face.back{transform:rotateY(180deg)}
.big{font-size:26px;font-weight:700;text-align:center}
.small{font-size:14px;color:var(--muted);margin-top:6px;text-align:center}
.spacer{height:14px}
.right{margin-left:auto}
.pill{display:inline-flex;align-items:center;gap:6px;border:1px solid var(--border);
background:#fff;border-radius:999px;padding:6px 10px;font-size:12px}
.dot{width:8px;height:8px;border-radius:50%}
.dot.on{background:var(--success)} .dot.off{background:#bbb}
.spinner{display:inline-block;width:16px;height:16px;border:2px solid #ddd;border-top-color:#888;
border-radius:50%;animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>
<body>

<div class="wrap">
<div class="topbar">
<div class="brand">í”Œë˜ì‹œì¹´ë“œ</div>
<div class="settings">
<span class="pill"><span id="autoDot" class="dot off"></span> ìë™ì™„ì„±: <b id="autoLabel">OFF</b></span>
<button id="toggleAuto" class="btn">í† ê¸€</button>
</div>
</div>

<div class="card" style="margin-bottom:16px">
<div class="row">
<div>
<label>ë‹¨ì–´</label>
<input id="word" type="text" placeholder="ì˜ˆ: apple">
</div>
<div>
<label>ëœ»</label>
<textarea id="meaning" placeholder="ëœ»ì„ ì§ì ‘ ì…ë ¥í•˜ê±°ë‚˜ ìë™ì™„ì„±í•˜ì„¸ìš”."></textarea>
<div class="spacer"></div>
<div class="toolbar">
<button id="btnAuto" class="btn accent">ìë™ì™„ì„±</button>
<button id="btnCancel" class="btn">ì·¨ì†Œ</button>
<span id="autoStatus" class="hint"></span>
<div class="right"></div>
<button id="btnAdd" class="btn primary">ì¶”ê°€</button>
<button id="btnClear" class="btn danger">ì´ˆê¸°í™”</button>
</div>
</div>
</div>
</div>

<div class="card">
<div class="toolbar">
<button id="btnStart" class="btn success">ì—°ìŠµ ì‹œì‘</button>
<button id="btnPrev" class="btn">ì´ì „</button>
<button id="btnNext" class="btn">ë‹¤ìŒ</button>
<button id="btnFlip" class="btn">ë’¤ì§‘ê¸°</button>
</div>

<div class="stage">
<div id="flip" class="flip">
<div class="flip-inner">
<div class="face front">
<div><div id="frontWord" class="big">ì¹´ë“œë¥¼ ì¶”ê°€í•˜ì„¸ìš”</div><div id="frontIdx" class="small">â€”</div></div>
</div>
<div class="face back">
<div><div id="backMeaning" class="big">ëœ»</div><div id="backIdx" class="small">â€”</div></div>
</div>
</div>
</div>
</div>

<h3 style="margin-top:18px;margin-bottom:8px">ë‚´ ì¹´ë“œ</h3>
<div id="list" class="list"></div>
</div>
</div>


<script>
/* -----------------------------
   ìƒíƒœ
----------------------------- */
const LS_CARDS="fc_cards_v1",LS_AUTO="fc_auto_v1";
const st={cards:[],idx:0,flip:false,auto:false};

/* -----------------------------
   ë„êµ¬
----------------------------- */
const q=s=>document.querySelector(s);
const esc=s=>(s||"").replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
const clamp=(x,a,b)=>Math.max(a,Math.min(b,x));

/* -----------------------------
   ìš”ì†Œ
----------------------------- */
const elWord=q("#word"),elMean=q("#meaning"),elList=q("#list"),
elAutoDot=q("#autoDot"),elAutoLabel=q("#autoLabel"),elStatus=q("#autoStatus"),
flip=q("#flip"),frontW=q("#frontWord"),frontI=q("#frontIdx"),backM=q("#backMeaning"),backI=q("#backIdx");

/* -----------------------------
   ë¡œë“œ/ì €ì¥
----------------------------- */
function load(){
  try{st.cards=JSON.parse(localStorage.getItem(LS_CARDS)||"[]")}catch{}
  st.auto=localStorage.getItem(LS_AUTO)==="1";
}
function saveCards(){localStorage.setItem(LS_CARDS,JSON.stringify(st.cards));}
function saveAuto(){localStorage.setItem(LS_AUTO,st.auto?"1":"0");}

/* -----------------------------
   ìë™ì™„ì„± í‘œì‹œ
----------------------------- */
function renderAuto(){
  elAutoLabel.textContent=st.auto?"ON":"OFF";
  elAutoDot.className="dot "+(st.auto?"on":"off");
}

/* -----------------------------
   ì¹´ë“œ ë Œë”
----------------------------- */
let pendingCard=null;

function applyCard(c){
  frontW.textContent=c.word;
  backM.textContent=c.meaning||"(ë¹ˆ ëœ»)";
  frontI.textContent=backI.textContent=`${st.idx+1}/${st.cards.length}`;
}

function renderStage(){
  if(!st.cards.length){
    applyCard({word:"ì¹´ë“œë¥¼ ì¶”ê°€í•˜ì„¸ìš”",meaning:"ëœ»"});
    frontI.textContent=backI.textContent="â€”";
    return;
  }

  pendingCard = st.cards[st.idx];

  // ğŸ‘‰ ë’¤ì§‘íŒ ìƒíƒœì—ì„œ ë„˜ê¸¸ ê²½ìš°: ì¦‰ì‹œ ì•ë©´ í‘œì‹œ í›„ í…ìŠ¤íŠ¸ ê°±ì‹ 
  if(st.flip){
    setFlip(false);               // ì•ë©´ìœ¼ë¡œ ëŒë¦¼
    applyCard(pendingCard);       // ì¦‰ì‹œ ìƒˆ ì¹´ë“œ ë‚´ìš© í‘œì‹œ
    pendingCard=null;
  } else {
    applyCard(pendingCard);
    pendingCard=null;
  }
}

/* flip ì• ë‹ˆë©”ì´ì…˜ ëë‚¬ì„ ë•Œ (ë°±ì—… ì•ˆì „ì¥ì¹˜) */
flip.querySelector(".flip-inner").addEventListener("transitionend",()=>{
  if(pendingCard){ applyCard(pendingCard); pendingCard=null; }
});

/* -----------------------------
   Flip
----------------------------- */
function setFlip(v){
  st.flip=v;
  flip.classList.toggle("is-flipped",v);
}

/* -----------------------------
   ì¹´ë“œ ì´ë™
----------------------------- */
function nextCard(){
  if(!st.cards.length)return;
  st.idx=(st.idx+1)%st.cards.length;
  renderStage();
}
function prevCard(){
  if(!st.cards.length)return;
  st.idx=(st.idx-1+st.cards.length)%st.cards.length;
  renderStage();
}

/* -----------------------------
   ë¦¬ìŠ¤íŠ¸ ë Œë”
----------------------------- */
function renderList(){
  elList.innerHTML="";
  st.cards.forEach((c,i)=>{
    const d=document.createElement("div");
    d.className="item";
    d.innerHTML=`<h4>${esc(c.word)}</h4><p>${esc(c.meaning||"(ëœ» ëŒ€ê¸° ì¤‘)")}</p>
    <div class="toolbar">
      <button class='btn' data-i='${i}' data-act='go'>ì´ ì¹´ë“œë¡œ</button>
      <button class='btn danger' data-i='${i}' data-act='del'>ì‚­ì œ</button>
    </div>`;
    elList.appendChild(d);
  });
}

/* -----------------------------
   UI ë²„íŠ¼
----------------------------- */
q("#btnFlip").onclick=()=>setFlip(!st.flip);
flip.onclick=()=>setFlip(!st.flip);

q("#btnPrev").onclick=prevCard;
q("#btnNext").onclick=nextCartd=nextCard;

/* -----------------------------
   ìŠ¤ì™€ì´í”„
----------------------------- */
let startX=0;
flip.addEventListener("touchstart",e=>startX=e.touches[0].clientX);
flip.addEventListener("touchend",e=>{
  const dx=e.changedTouches[0].clientX-startX;
  if(Math.abs(dx)<40)return;
  dx<0?nextCard():prevCard();
});

/* -----------------------------
   ì¹´ë“œ ì¶”ê°€ + ìë™ì™„ì„± fetch
----------------------------- */
q("#btnAdd").onclick=()=>{
  const w=elWord.value.trim(),m=elMean.value.trim();
  if(!w)return alert("ë‹¨ì–´ ì…ë ¥");
  if(!m && !st.auto)return alert("ëœ» ì…ë ¥í•˜ê±°ë‚˜ ìë™ì™„ì„± ì¼œì„¸ìš”");

  const c={word:w,meaning:m||null};
  st.cards.push(c);
  saveCards();renderList();

  st.idx=st.cards.length-1;
  renderStage();
  setFlip(false);

  if(st.auto && !m){
    const idx=st.idx;
    fetch(`/api/define?q=${encodeURIComponent(w)}`)
      .then(r=>r.json()).then(d=>{
        if(d.ok&&d.meaning){
          st.cards[idx].meaning=d.meaning;
          saveCards();renderList();
          if(st.idx===idx)renderStage();
        }
      });
  }

  elWord.value=elMean.value="";
};

/* ìˆ˜ë™ ìë™ì™„ì„± ë²„íŠ¼ */
q("#btnAuto").onclick=async()=>{
  const w=elWord.value.trim();
  if(!w)return alert("ë‹¨ì–´ ì…ë ¥");

  elStatus.innerHTML="<span class='spinner'></span> ë¡œë”©...";
  try{
    const r=await fetch(`/api/define?q=${encodeURIComponent(w)}`);
    const d=await r.json();
    if(d.ok&&d.meaning){elMean.value=d.meaning;elStatus.textContent="ì™„ë£Œ";}
    else elStatus.textContent="ì—†ìŒ";
  }catch{elStatus.textContent="ì˜¤ë¥˜";}
};

/* -----------------------------
   ê¸°íƒ€
----------------------------- */
q("#toggleAuto").onclick=()=>{st.auto=!st.auto;saveAuto();renderAuto();};
q("#btnClear").onclick=()=>{if(confirm("ëª¨ë‘ ì‚­ì œ?")){st.cards=[];saveCards();renderList();renderStage();}};
q("#btnCancel").onclick=()=>{elStatus.textContent="";};

elList.onclick=e=>{
  const b=e.target.closest("button");if(!b)return;
  const i=+b.dataset.i;
  if(b.dataset.act==="del"){
    st.cards.splice(i,1);saveCards();renderList();renderStage();
  }else{
    st.idx=i;renderStage();setFlip(false);scrollTo({top:0,behavior:"smooth"});
  }
};

q("#btnStart").onclick=()=>{
  if(!st.cards.length)return alert("ì¹´ë“œ ì—†ìŒ");
  st.study=!st.study;
  if(st.study){
    st.original=[...st.cards];
    st.cards.sort(()=>Math.random()-0.5);
    saveCards();
    st.idx=0;renderStage();setFlip(false);
    q("#btnStart").textContent="ì—°ìŠµ ì¤‘ì§€";
    q("#btnStart").classList.replace("success","danger");
    elList.style.display="none";
  }else{
    st.cards=[...st.original];saveCards();renderList();renderStage();
    q("#btnStart").textContent="ì—°ìŠµ ì‹œì‘";
    q("#btnStart").classList.replace("danger","success");
    elList.style.display="grid";
  }
};

/* -----------------------------
   Init
----------------------------- */
load();renderAuto();renderList();renderStage();
</script>
</body>
</html>
